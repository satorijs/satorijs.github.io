import{_ as t,V as n,z as l,m as h,q as e,ab as p,Y as i,A as r,l as o}from"./chunks/framework.xAOSN7W3.js";const C=JSON.parse('{"title":"Passive Requests Experimental","description":"","frontmatter":{},"headers":[],"relativePath":"en-US/advanced/passive.md","filePath":"en-US/advanced/passive.md"}'),k={name:"en-US/advanced/passive.md"},d={id:"passive-requests",tabindex:"-1"};function g(c,s,u,B,y,m){const a=n("badge");return h(),l("div",null,[e("h1",d,[s[1]||(s[1]=i("Passive Requests ",-1)),r(a,{type:"warning"},{default:o(()=>[...s[0]||(s[0]=[i("Experimental",-1)])]),_:1}),s[2]||(s[2]=i()),s[3]||(s[3]=e("a",{class:"header-anchor",href:"#passive-requests","aria-label":'Permalink to "Passive Requests <badge type="warning">Experimental</badge>"'},"​",-1))]),s[4]||(s[4]=p(`<div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Passive request capabilities are primarily provided through bots and triggered by users within chat applications. If the chat platform you are implementing or integrating does not support bot-related features, you can safely ignore this section.</p></div><p>Operations performed by bots through API calls can be roughly divided into two categories:</p><ul><li><strong>Active operations</strong>: Operations that can be performed without user interaction, such as scheduled message delivery;</li><li><strong>Passive operations</strong>: Operations performed in response to users, such as answering questions when a user mentions &quot;@bot&quot;.</li></ul><p>At the protocol level, both types of operations are expressed using the unified <a href="./../resources/message.html#api-message-create"><code>/message.create</code></a> interface. However, some platforms may distinguish between these two types of operations and impose restrictions on active operations, such as:</p><ul><li>Rate limiting active message sending;</li><li>Requiring the original event ID (or other context information) that triggered the API call to be included when sending response messages;</li><li>Only allowing responses to an interaction within a specific time window.</li></ul><p>In such cases, using the standard message sending interface alone cannot meet the parameter requirements for &quot;passive requests&quot;. To address this, Satori provides an additional <code>referrer</code> field.</p><h2 id="referrer-field" tabindex="-1"><code>referrer</code> Field <a class="header-anchor" href="#referrer-field" aria-label="Permalink to &quot;\`referrer\` Field&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note: The correct spelling is <code>referrer</code>, not <code>referer</code>.</p></div><p>When the SDK pushes events, it can include an additional <code>event.referrer</code> field to carry the “source context” required by the platform for passive requests (such as the original event ID, callback token, thread information, etc.).</p><p>When implementing passive operations, the application side needs to pass the <code>referrer</code> from the source event as an API parameter as-is. This way, the SDK can clearly identify that this request is a passive operation and use the information in <code>referrer</code> to complete the platform API call.</p><p>The content of <code>referrer</code> is determined by the adapter, and the protocol does not impose strict constraints on its structure. In practice, it is recommended to only include useful information to avoid making the <code>referrer</code> field excessively long.</p><h2 id="example" tabindex="-1">Example (Lark) <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example (Lark)&quot;">​</a></h2><p>Taking the Lark platform as an example: when receiving a message, the official adapter will deliver the following <code>referrer</code> field:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;sn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message-created&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;channel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;user message&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;referrer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // The fields here are defined internally by the Lark platform</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // and are unrelated to the Satori protocol</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;im.message.receive_v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>When the application replies to this message (i.e., a passive operation), it should pass this <code>referrer</code> as a parameter to <a href="./../resources/message.html#api-message-create"><code>/message.create</code></a>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;channel_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;reply to user message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;referrer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // The fields here are defined internally by the Lark platform</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // and are unrelated to the Satori protocol</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;im.message.receive_v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div>`,16))])}const f=t(k,[["render",g]]);export{C as __pageData,f as default};
