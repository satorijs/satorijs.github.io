import{_ as n,V as t,z as h,m as l,q as a,ab as p,Y as i,A as k,l as r}from"./chunks/framework.xAOSN7W3.js";const x=JSON.parse('{"title":"被动请求 实验性","description":"","frontmatter":{},"headers":[],"relativePath":"zh-CN/advanced/passive.md","filePath":"zh-CN/advanced/passive.md"}'),d={name:"zh-CN/advanced/passive.md"},o={id:"被动请求",tabindex:"-1"};function g(B,s,c,u,y,C){const e=t("badge");return l(),h("div",null,[a("h1",o,[s[1]||(s[1]=i("被动请求 ",-1)),k(e,{type:"warning"},{default:r(()=>[...s[0]||(s[0]=[i("实验性",-1)])]),_:1}),s[2]||(s[2]=i()),s[3]||(s[3]=a("a",{class:"header-anchor",href:"#被动请求","aria-label":'Permalink to "被动请求 <badge type="warning">实验性</badge>"'},"​",-1))]),s[4]||(s[4]=p(`<div class="tip custom-block"><p class="custom-block-title">TIP</p><p>被动请求能力主要通过机器人提供，并由用户在聊天应用中触发。如果你要实现或接入的聊天平台不支持机器人相关功能，那么可以直接忽略本节。</p></div><p>聊天机器人调用 API 进行的操作可以粗略分为两类：</p><ul><li><strong>主动操作</strong>：不依赖用户交互就能进行的操作，例如定时推送消息；</li><li><strong>被动操作</strong>：以响应用户为目的而进行的操作，例如回答用户“@机器人”的问题。</li></ul><p>在协议侧，上述两种操作都使用统一的 <a href="./../resources/message.html#api-message-create"><code>/message.create</code></a> 接口表达。然而，部分平台可能会区分上述两类操作，并对主动操作进行限制，例如：</p><ul><li>限制主动发送消息的速率；</li><li>强制要求在回传消息时携带触发 API 调用的原始事件 ID (或其他上下文信息)；</li><li>仅允许在特定时间窗口内对某次交互进行回应。</li></ul><p>在这种情况下，仅仅使用标准的发送消息接口就无法满足“被动请求”所需的参数要求。为此，Satori 提供了额外的 <code>referrer</code> 字段来解决问题。</p><h2 id="referrer-字段" tabindex="-1"><code>referrer</code> 字段 <a class="header-anchor" href="#referrer-字段" aria-label="Permalink to &quot;\`referrer\` 字段&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>注意：正确的拼写是 <code>referrer</code> 而不是 <code>referer</code>。</p></div><p>当 SDK 推送事件时，可以额外携带一个 <code>event.referrer</code> 字段，用于承载平台进行被动请求所需的“来源上下文” (例如原始事件 ID、回调 token、thread 信息等)。</p><p>应用侧在实现被动操作时，需要将来源事件的 <code>referrer</code> 原样作为 API 参数传入。这样一来，SDK 就可以明确知道此次请求属于被动操作，并利用 <code>referrer</code> 中的信息完成平台 API 调用。</p><p><code>referrer</code> 的内容由适配器决定，协议不对其结构做强约束。在实践上，建议仅仅下发有用的信息，避免 <code>referrer</code> 字段过于冗长。</p><h2 id="示例" tabindex="-1">示例 (Lark) <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例 (Lark)&quot;">​</a></h2><p>以 Lark 平台为例：在接收到消息时，官方适配器会下发以下 <code>referrer</code> 字段：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;sn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message-created&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;channel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;user message&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;referrer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 这里的字段都是 Lark 平台内部定义的，与 Satori 协议无关</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;im.message.receive_v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>应用在回复该消息 (即被动操作) 时，应当将该 <code>referrer</code> 作为参数传入 <a href="./../resources/message.html#api-message-create"><code>/message.create</code></a>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;channel_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;reply to user message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;referrer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 这里的字段都是 Lark 平台内部定义的，与 Satori 协议无关</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;im.message.receive_v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxxxx&quot;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div>`,16))])}const E=n(d,[["render",g]]);export{x as __pageData,E as default};
